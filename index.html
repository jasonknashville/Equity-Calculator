<!doctype html>
<html lang="en">
<head>
  <!-- Google Tag Manager -->
  <script>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MH9X9NGV');
  </script>
  <!-- End Google Tag Manager -->

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Equity Growth Calculator</title>

  <style>
    :root{
      --remax-red:#dc1c2e;
      --remax-blue:#003da5;
      --bg:#f5f7fb;
      --card:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --line:#e5e7eb;
    }

    *{box-sizing:border-box}

    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:var(--bg);
      color:var(--text);
    }

    .banner-red{height:12px;background:var(--remax-red)}
    .banner-blue{height:10px;background:var(--remax-blue)}

    .wrap{max-width:1100px;margin:0 auto;padding:28px 18px 48px}

    header{
      display:flex;
      align-items:center;
      gap:16px;
      margin-bottom:20px;
    }

    header img{height:42px}

    h1{
      font-size:26px;
      margin:0;
      font-weight:700;
    }

    .sub{
      color:var(--muted);
      margin-top:4px;
      font-size:14px;
    }

    .grid{
      display:grid;
      grid-template-columns:1fr;
      gap:18px;
    }

    @media(min-width:900px){
      .grid{grid-template-columns:1.1fr .9fr}
    }

    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:14px;
      padding:18px;
    }

    .card h2{
      font-size:16px;
      margin:0 0 14px 0;
    }

    label{
      font-size:12px;
      color:var(--muted);
      margin-bottom:6px;
      display:block;
    }

    input,select{
      width:100%;
      padding:10px;
      border-radius:10px;
      border:1px solid var(--line);
      font-size:14px;
    }

    input[type="range"]{padding:0}

    .row{
      display:grid;
      grid-template-columns:1fr;
      gap:14px;
      margin-bottom:14px;
    }

    @media(min-width:640px){
      .row{grid-template-columns:1fr 1fr}
    }

    .hint{
      font-size:12px;
      color:var(--muted);
      margin-top:6px;
      line-height:1.35;
    }

    .decline{
      color:#b91c1c;
      font-weight:600;
    }

    .actions{
      display:flex;
      gap:10px;
      margin-top:14px;
      flex-wrap:wrap;
    }

    button{
      padding:10px 14px;
      border-radius:12px;
      border:1px solid var(--line);
      background:#f9fafb;
      cursor:pointer;
      font-size:13px;
    }

    button:hover{background:#f3f4f6}

    .kpi{
      display:grid;
      gap:14px;
    }

    .kpi-box{
      border:1px solid var(--line);
      border-radius:12px;
      padding:14px;
    }

    .kpi-label{
      font-size:12px;
      color:var(--muted);
      margin-bottom:4px;
    }

    .kpi-value{
      font-size:20px;
      font-weight:700;
    }

    table{
      width:100%;
      border-collapse:collapse;
      margin-top:16px;
      font-size:13px;
    }

    th,td{
      padding:8px;
      border-bottom:1px solid var(--line);
      text-align:right;
    }

    th:first-child,td:first-child{text-align:left}

    .footer-note{
      margin-top:22px;
      font-size:11px;
      color:var(--muted);
      line-height:1.4;
    }
  </style>
</head>

<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MH9X9NGV"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <div class="banner-red"></div>
  <div class="banner-blue"></div>

  <div class="wrap">
    <header>
      <img src="https://kvcore-library.s3.amazonaws.com/remax1stchoice8207/images/03b9616f75a8e185d56a93c799829fdf.png" alt="Jason Kaczmarski Team">
      <div>
        <h1>Equity Growth Calculator</h1>
        <div class="sub">
          See how equity can build over time from your mortgage payments and home value growth.
        </div>
      </div>
    </header>

    <div class="grid">
      <!-- Inputs -->
      <section class="card">
        <h2>Inputs</h2>

        <div class="row">
          <div>
            <label>Purchase price</label>
            <input id="price" type="number" inputmode="decimal" value="400000">
          </div>
          <div>
            <label>Mortgage term (years)</label>
            <select id="term">
              <option value="30" selected>30</option>
              <option value="20">20</option>
              <option value="15">15</option>
              <option value="10">10</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div>
            <label>Down payment (%)</label>
            <input id="dpPct" type="number" min="0" max="100" step="0.1" value="5">
          </div>
          <div>
            <label>Interest rate (APR %)</label>
            <input id="rate" type="number" min="0" max="25" step="0.01" value="6.25">
          </div>
        </div>

        <div class="row">
          <div>
            <label>Home value growth (% / year)</label>
            <input id="app" type="range" min="-5" max="50" step="0.25" value="4.5">
            <div class="hint">
              <span id="appValue">4.50% growth per year</span>
              <span id="appLabelExtra"> · 4.5% has been the long-term historical average in the U.S.</span>
            </div>
          </div>

          <div>
            <label>Time horizon (years)</label>
            <input id="years" type="range" min="1" max="30" step="1" value="5">
            <div class="hint"><span id="yearsValue">5</span> years</div>
          </div>
        </div>

        <div class="actions">
          <button id="copyLinkBtn" type="button">Copy shareable link</button>
          <button id="resetBtn" type="button">Reset</button>
        </div>
      </section>

      <!-- Results -->
      <aside class="card">
        <h2>Results</h2>

        <div class="kpi">
          <div class="kpi-box">
            <div class="kpi-label">Estimated home value</div>
            <div class="kpi-value" id="homeValue">$—</div>
          </div>

          <div class="kpi-box">
            <div class="kpi-label">Remaining mortgage balance</div>
            <div class="kpi-value" id="balance">$—</div>
          </div>

          <div class="kpi-box">
            <div class="kpi-label">Total equity</div>
            <div class="kpi-value" id="equity">$—</div>
          </div>
        </div>

        <table>
          <thead>
            <tr>
              <th>Year</th>
              <th>Home Value</th>
              <th>Mortgage Balance</th>
              <th>Equity</th>
            </tr>
          </thead>
          <tbody id="tableBody"></tbody>
        </table>
      </aside>
    </div>

    <div class="footer-note">
      This is a simplified illustration for educational purposes only. It does not include taxes,
      insurance, HOA fees, maintenance, closing costs, PMI, refinancing, or selling costs.
      Results are not a guarantee of future performance.
    </div>
  </div>

<script>
/* ============================
   GTM / dataLayer helpers
============================ */
window.dataLayer = window.dataLayer || [];

function dlPush(event, payload = {}) {
  window.dataLayer.push({
    event,
    tool: "equity_calculator",
    page: window.location.pathname,
    ...payload
  });
}

function debounce(fn, delay=500){
  let t;
  return (...args)=>{
    clearTimeout(t);
    t = setTimeout(()=>fn(...args), delay);
  };
}

/* ============================
   Helpers + calculation
============================ */
const el = (id)=>document.getElementById(id);

function money(n){
  const x = Number(n);
  if (!isFinite(x)) return "$—";
  return x.toLocaleString(undefined,{style:'currency',currency:'USD',maximumFractionDigits:0});
}

function clamp(n,min,max){ return Math.min(max, Math.max(min, n)); }

/* ============================
   DOM
============================ */
const priceEl = el('price');
const dpPctEl = el('dpPct');
const termEl  = el('term');
const rateEl  = el('rate');
const appEl   = el('app');
const yearsEl = el('years');

const appValueEl = el('appValue');
const appLabelExtraEl = el('appLabelExtra');
const yearsValueEl = el('yearsValue');

const homeValueEl = el('homeValue');
const balanceEl = el('balance');
const equityEl = el('equity');
const tableBodyEl = el('tableBody');

/* ============================
   URL params (apply + build)
   - Keeps any existing utm_* params
============================ */
function applyQuery(){
  const params = new URLSearchParams(window.location.search);
  if (!params.size) return;

  if (params.get('price')) priceEl.value = params.get('price');
  if (params.get('dp')) dpPctEl.value = params.get('dp');
  if (params.get('term')) termEl.value = params.get('term');
  if (params.get('rate')) rateEl.value = params.get('rate');
  if (params.get('app')) appEl.value = params.get('app');
  if (params.get('years')) yearsEl.value = params.get('years');
}

function buildShareParams(){
  const params = new URLSearchParams(window.location.search); // keeps utm_*
  params.set('price', String(priceEl.value || ''));
  params.set('dp', String(dpPctEl.value || ''));
  params.set('term', String(termEl.value || ''));
  params.set('rate', String(rateEl.value || ''));
  params.set('app', String(appEl.value || ''));
  params.set('years', String(yearsEl.value || ''));
  return params;
}

/* ============================
   Core calc (simple, fast, stable)
   NOTE: Mortgage balance here is a simplified illustration.
============================ */
function calc(){
  const price = clamp(Number(priceEl.value), 0, 1e9);
  const dpPct = clamp(Number(dpPctEl.value), 0, 100);
  const termYears = clamp(Number(termEl.value), 1, 50);
  const annualRatePct = clamp(Number(rateEl.value), 0, 25);
  const years = clamp(Number(yearsEl.value), 1, 30);
  const appPct = clamp(Number(appEl.value), -5, 50);

  // Slider readouts
  yearsValueEl.textContent = String(years);

  if (appPct < 0) {
    appValueEl.textContent = `${Math.abs(appPct).toFixed(2)}% decline per year`;
    appValueEl.classList.add('decline');
    appLabelExtraEl.textContent = '';
  } else {
    appValueEl.textContent = `${appPct.toFixed(2)}% growth per year`;
    appValueEl.classList.remove('decline');
    appLabelExtraEl.textContent = ' · 4.5% has been the long-term historical average in the U.S.';
  }

  // Simple equity math:
  const dp = price * (dpPct/100);
  const loan0 = Math.max(0, price - dp);

  // Illustrative balance glide (keeps it light + stable visually):
  // Starts at loan0 and reduces roughly linearly over time.
  // If you want, we can swap back to full amortization later.
  const annualPrincipalPaydown = loan0 / termYears; // simple linear
  const balanceEnd = Math.max(0, loan0 - (annualPrincipalPaydown * years));

  const g = appPct / 100;
  const valueEnd = price * Math.pow(1 + g, years);
  const equityEnd = valueEnd - balanceEnd;

  homeValueEl.textContent = money(valueEnd);
  balanceEl.textContent = money(balanceEnd);
  equityEl.textContent = money(equityEnd);

  // Table
  tableBodyEl.innerHTML = '';
  for (let y=0; y<=years; y++){
    const value = price * Math.pow(1 + g, y);
    const bal = Math.max(0, loan0 - (annualPrincipalPaydown * y));
    const eq = value - bal;

    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${y}</td>
      <td>${money(value)}</td>
      <td>${money(bal)}</td>
      <td>${money(eq)}</td>
    `;
    tableBodyEl.appendChild(tr);
  }

  // Debounced GTM event (so GA4 event tag can fire)
  debouncedUpdate({
    inputs: {
      purchase_price: price,
      down_payment_pct: dpPct,
      mortgage_term_years: termYears,
      interest_rate_apr_pct: annualRatePct,
      appreciation_rate_pct: appPct,
      horizon_years: years
    },
    outputs: {
      home_value: valueEnd,
      mortgage_balance: balanceEnd,
      equity: equityEnd
    }
  });
}

const debouncedUpdate = debounce((payload)=>{
  dlPush('equity_calc_update', payload);
}, 600);

/* ============================
   Events
============================ */
[priceEl, dpPctEl, termEl, rateEl, appEl, yearsEl].forEach(x=>{
  x.addEventListener('input', calc);
  x.addEventListener('change', calc);
});

el('copyLinkBtn').addEventListener('click', async ()=>{
  const params = buildShareParams();
  const url = `${window.location.origin}${window.location.pathname}?${params.toString()}`;
  try{
    await navigator.clipboard.writeText(url);
    dlPush('equity_calc_share_link_copied');
    el('copyLinkBtn').textContent = 'Copied!';
    setTimeout(()=> el('copyLinkBtn').textContent = 'Copy shareable link', 1200);
  }catch(e){
    alert('Could not copy automatically. Link:\n' + url);
  }
});

el('resetBtn').addEventListener('click', ()=>{
  priceEl.value = 400000;
  dpPctEl.value = 5;
  termEl.value = 30;
  rateEl.value = 6.25;
  appEl.value = 4.5;
  yearsEl.value = 5;
  history.replaceState({}, '', window.location.pathname); // keeps it clean
  calc();
});

/* ============================
   Init
============================ */
applyQuery();
calc();
dlPush('equity_calc_loaded');
</script>
</body>
</html>
